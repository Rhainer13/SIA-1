{% load static tailwind_tags %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FERMA STAINLESS WORKS</title>
    <link rel="icon" href="{% static 'images/Logo.png'%}" type="image/png">
    {% tailwind_css %}
</head>
<body class="font-Nats overflow-auto" >
    <header class="flex bg-gray-1 w-full">
        <img src="{% static 'images/Logo.png'%}" alt="Ferma Steel works" class="ml-20 w-28 h-20">
        <h1 class="text-white font-bold mt-5 ml-2 sm:text-xs md:text-4xl">FERMA STAINLESS WORKS</h1>
    </header>
    <main class="flex w-full min-h-screen bg-white overflow-hidden">
        <!--vertical navbar-->
        <div class=" min-h-screen flex flex-col bg-gray-2 w-[6rem] text-white items-center">
            <!--container-->
            <div class="flex flex-col mx-2 flex-grow items-center w-full">
                <div class="py-4 flex flex-col items-center mb-4">
                    <img src="{% static 'images/user-icon.png'%}" alt="user-icon" class="w-7 h-7 mb-3">
                    <p class="text-white items-center text-sm">{{admin_name}}</p>
                    <p class="text-white items-center text-sm">Admin</p>
                </div>
                <ul class="flex flex-col items-center space-y-2 min-w-full">
                    <!--Request-->
                    <li class="flex flex-col items-center hover:bg-slate-900 hover:text-orange-500 min-w-full pt-1">
                        <a href="{% url 'admin_request' %}" class="mt-1">
                            <img src="{% static 'images/Request.png' %}" alt="Request" class="w-6 h-6 ml-5">
                            Request
                        </a>
                    </li>
                    <!--Inventory-->
                    <li class="group flex flex-col items-center hover:bg-slate-900 hover:text-orange-500 min-w-full pt-1">
                        <a href="{% url 'admin_inventory' %}" class="mt-1">
                            <img src="{% static 'images/inventory.png' %}" alt="Inventory" class="w-6 h-6 ml-6">
                            Inventory
                        </a>
                    </li>
                    <!--Account-->
                    <li class="relative group flex flex-col items-center min-w-full pt-1">
                        <img src="{% static 'images/account.png' %}" alt="Account" class="w-6 h-6">
                            Account
                        <!--hover submenu-->
                        <ul class="absolute left-[5.5rem] mt-1 hidden group-hover:block bg-gray-2 rounded-md z-10">
                            <li>
                                <a href="{% url 'admin_create_account' %}" 
                                    class="block px-4 py-2 hover:bg-slate-900 hover:text-orange-500 rounded-md">
                                    Create Account
                                </a>
                            </li>
                            <li>
                                <a href="{% url 'Account_list' %}" 
                                    class="block px-4 py-2 hover:bg-slate-900 hover:text-orange-500 rounded-md">
                                        Accounts
                                </a>
                            </li>
                        </ul>
                    </li>
                    <!--Reports-->
                    <li class="relative group flex flex-col items-center min-w-full pt-1">
                        <img src="{% static 'images/reports.png' %}" alt="Reports" class="w-6 h-6">
                            Reports
                        <!--hover submenu-->
                        <ul class="absolute left-[5.5rem] mt-1 hidden group-hover:block bg-gray-2 rounded-md z-10">
                            <li class="w-[9rem] text-center">
                                <a href="{% url 'item_request_reports'%}" class="block px-3 py-2 hover:bg-slate-900 hover:text-orange-500 rounded-md">
                                    Item Requests
                                </a>
                            </li>
                            <li class="w-[9rem] text-center">
                                <a href="{% url 'job_request_reports'%}" class="block px-3 py-2 hover:bg-slate-900 hover:text-orange-500 rounded-md">
                                    Job Requests
                                </a>
                            </li>
                            <li class="w-[9rem] text-center">
                                <a href="{% url 'purchase_order_reports'%}" class="block px-3 py-2 hover:bg-slate-900 hover:text-orange-500 rounded-md">
                                    Order Requests
                                </a>
                            </li>
                            <li class="w-[9rem] text-center">
                                <a href="{% url 'delivery_history_reports' %}" class="block px-3 py-2 hover:bg-slate-900 hover:text-orange-500 rounded-md">
                                    Delivery History
                                </a>
                            </li>
                        </ul>
                    </li>
                    <!--Supplier-->
                    <li class="flex flex-col items-center hover:bg-slate-900 hover:text-orange-500 min-w-full pt-1">
                        <a href="{% url 'admin_supplier' %}" class="mt-1">
                            <img src="{% static 'images/Supplier.png' %}" alt="Supplier" class="w-7 h-7 ml-4">
                            Supplier
                        </a>
                    </li>
                </ul>
                <!--Delivery-->
                <li class="group flex flex-col items-center hover:bg-slate-900 hover:text-orange-500 min-w-full pt-1">
                    <a href="{% url 'create_delivery' %}" class="mt-1">
                        <img src="{% static 'images/delivery.png' %}" alt="Inventory" class="w-8 h-8 ml-4">
                        Delivery
                    </a>
                </li>
                <!--Logout-->
                <ul class="mt-auto min-w-full hover:text-orange-500">
                    <li class="flex flex-col items-center min-w-full hover:bg-slate-900 pt-2">
                        <a href="{% url 'Logout'%}" class="">
                            <img src="{% static 'images/logout.png'%}" alt="logout" class="w-6 h-6 ml-3">
                            <p class="mt-2 pb-3">Log out</p>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
        {% block content %}
        <!--container div-->
        <div class="w-full bg-white flex justify-center items-center mt-10 relative">
            <!-- Messages Section -->
            {% if messages %}
                {% for message in messages %}
                <div id="notifications" class="px-4 py-2 rounded absolute top-2 left-1/2 transform -translate-x-1/2 
                    text-white {% if message.tags == 'error' %}bg-red-500
                    {% endif %}">
                    {{ message }}
                </div>
                {% endfor %}
            {% endif %}
            <div class="w-[50rem] h-[30rem]">
                <!--table container-->
                <div class="min-w-full h-[25rem] bg-gray-3 overflow-auto" id="request-container">
                    <table class="w-full">
                        <thead class="bg-gray-200 border-b-3 border-gray-200">
                            <tr class="">
                                <th class="p-3 text-sm font-semibold tracking-wide text-center">Request ID</th>
                                <th class="p-3 text-sm font-semibold tracking-wide text-center">Request Type</th>
                                <th class="p-3 text-sm font-semibold tracking-wide text-center">Date</th>
                                <th class="p-3 text-sm font-semibold tracking-wide text-center">Status</th>
                                <th class="p-3 text-sm font-semibold tracking-wide text-center">Action</th>
                            </tr>
                        </thead>
                        {% for request in requests %}
                        <tbody id="request-table">
                            <tr class="text-center">
                                <td class="pt-1 mt-1">{{request.request_id}}</td>
                                <td class="pt-1 mt-1">{{request.request_type}}</td>
                                <td class="pt-1 mt-1">{{request.request_date}}</td>
                                <td class="pt-1">
                                    <span class="bg-orange-600 text-white px-3 py-1 rounded-xl text-md" 
                                    id="status">{{request.request_status}}</span>
                                </td>
                                <td class="pt-1 mt-1">
                                    <button class="bg-gray-2 px-3 py-1 text-md hover:text-orange-500 rounded-lg text-white" 
                                        onclick="openModal('viewModal-{{request.request_id}}')">
                                        View
                                    </button>
                                    <!-- View Modal -->
                                    <div id="viewModal-{{request.request_id}}"
                                        class="modal hidden fixed inset-0 bg-black bg-opacity-50 items-center justify-center">
                                        <div class="bg-white rounded-lg p-6 space-y-4 justify-start items-start flex-col relative w-[23rem]">
                                            <button 
                                                class="text-black  rounded-full top-1 left-[21rem] absolute"
                                                onclick="closeModal('viewModal-{{ request.request_id }}')">
                                                <img src="{% static 'images/closebtn.png' %}" alt="closebutton" class="w-7 h-7 ">
                                            </button>
                                            <div class="flex justify-center items-center">
                                                <h2 class="text-lg font-bold">View Request</h2>
                                            </div>
                                            <div class="flex justify-start items-start flex-col space-y-2 ">
                                                <p ><strong >Request Type:</strong>{{ request.request_type }}</p>
                                                <p><strong >Date:</strong>{{ request.request_date }}</p>
                                            </div>
                                            <!--item Request-->
                                            {% if request.request_type == 'Item Request'%}
                                                <div class="flex justify-start items-start flex-col space-y-1">
                                                    <p>
                                                        <strong>Worker name:</strong> {{ request.request_user}}
                                                    </p>
                                                    <p>
                                                        <strong>item name:</strong> {{ request.request_item_name }}
                                                    </p>
                                                    <p>
                                                        <strong>item quantity:</strong> {{ request.request_item_quantity }}
                                                    </p>
                                                </div>
                                                <!--job request-->
                                            {% elif request.request_type == 'Job Request' %}
                                                <div class="flex justify-start items-start flex-col space-y-1">
                                                    <p>
                                                        <strong>Custodian name:</strong> {{ request.request_user}}
                                                    </p>
                                                    <p>
                                                        <strong>Item name: </strong> {{request.request_item_name}}
                                                    </p>
                                                    <p>
                                                        <strong>Quantity: </strong> {{request.request_item_quantity}}
                                                    </p>
                                                    <div class="flex justify-start items-start space-x-1">
                                                        <strong >Repair details: </strong>
                                                        <p class="flex-1">{{request.request_repair_details}}</p>
                                                    </div>
                                                </div>
                                            <!--Purchase order-->
                                            {% elif request.request_type == 'Purchase Order' %}
                                                <div class="flex justify-start items-start flex-col space-y-1">
                                                    <p>
                                                        <strong>Custodian name:</strong> {{ request.request_user}} 
                                                    </p>
                                                    <p>
                                                        <strong>Item name: </strong>
                                                        {{request.request_item_name}}
                                                    </p>
                                                    <p>
                                                        <strong>Quantity: </strong>
                                                        {{request.request_item_quantity}}
                                                    </p>
                                                </div>
                                            {% endif %}
                                            <div class="flex justify-center items-center w-full space-x-5">
                                                <button class="bg-gray-2 px-2 py-1 hover:text-orange-500 rounded-lg text-white" 
                                                    onclick="openModal('approveModal-{{request.request_id}}')">
                                                    approve
                                                </button>
                                                <button class="bg-gray-2 px-2 py-1 hover:text-orange-500 rounded-lg text-white" 
                                                    onclick="openModal('declineModal-{{request.request_id}}')">
                                                    decline
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <!--approve modal-->
                                    <div id="approveModal-{{request.request_id}}" class="modal hidden fixed inset-0 
                                    bg-black bg-opacity-50 items-center justify-center">
                                        <div class="bg-white rounded-lg p-6 space-y-4">
                                            <h2 class="text-lg font-bold">Approve Request</h2>
                                            <p>Are you sure you want to approve this request?</p>
                                            <div class="flex justify-center items-center space-x-2">
                                                <form method="POST" action="{% url 'admin_status_request' request_id=request.request_id %}">
                                                    {%csrf_token%}
                                                    <input type="hidden" value="approve" name="status">
                                                    <button 
                                                        class="bg-gray-2 text-white px-5 py-1.5 rounded-lg" type="submit"
                                                        onclick="closeModal('approveModal-{{request.request_id}}')">Yes</button>
                                                    </form>
                                                <button 
                                                    class="bg-gray-2 px-5 py-1.5 rounded-lg text-white"
                                                    onclick="closeModal('approveModal-{{request.request_id}}')">Cancel</button>
                                            </div>
                                        </div>
                                    </div>
                                    <!--decline Modal-->
                                    <div id="declineModal-{{request.request_id}}" class="modal hidden fixed inset-0 
                                    bg-black bg-opacity-50 items-center justify-center">
                                        <div class="bg-white rounded-lg p-6 space-y-4">
                                            <h2 class="text-lg font-bold">Decline Request</h2>
                                            <p>Are you sure you want to decline this request?</p>
                                            <div class="flex justify-center items-center space-x-2">
                                                <form method="POST" action="{% url 'admin_status_request' request_id=request.request_id %}">
                                                    {%csrf_token%}
                                                    <input type="hidden" value="decline" name="status">
                                                    <button 
                                                        class="bg-gray-2 text-white px-4 py-2 rounded-lg"
                                                        onclick="closeModal('declineModal-{{request.request_id}}')" 
                                                        type="submit">Yes</button>
                                                </form>
                                                <button 
                                                    class="bg-gray-2 px-4 py-2 text-white rounded-lg" type="button"
                                                    onclick="closeModal('declineModal-{{request.request_id}}')">Cancel</button>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                            </tr> 
                        </tbody>
                        {% endfor %}
                    </table>
                </div>
            </div>
            <div>

            </div>
        </div>
        <script>

            setTimeout(() => {
                    document.getElementById('notifications').style.display = 'none';
                }, 5000);
            function openModal(modalId) 
            {
                console.log('Opening modal:', modalId);
                const modal = document.getElementById(modalId);
                modal.classList.remove('hidden'); // Remove hidden class
                modal.classList.add('flex'); // Add flex for centering
            }
    
            function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.remove('flex'); // Remove flex to prevent display issues
            modal.classList.add('hidden'); // Add hidden class to hide modal
            }
        </script>
        {% endblock %}
    </main>
</body>
</html>